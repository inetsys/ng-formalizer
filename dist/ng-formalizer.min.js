var Formalizer;!function(){"use strict";function a(a,b){var c=a.indexOf(b);return-1!==c?a.splice(c,1):!1}function b(a){a["class"]=a["class"].filter(function(a){return a&&a.length?a:!1}).join(" ")}var c={};Formalizer=function(a,b,c,d){this.fields=[],this.$scope=a,this.$parse=b,this.$interpolate=c,this.$log=d},Formalizer.prototype.onSubmit=null,Formalizer.prototype.name=null,Formalizer.prototype.type=null,Formalizer.prototype.fields=null,Formalizer.prototype.attempts=0,Formalizer.prototype.horizontal=!1,Formalizer.prototype.vertical=!1,Formalizer.prototype.inline=!1,Formalizer.prototype.$scope=null,Formalizer.prototype.$parse=null,Formalizer.prototype.$log=null,Formalizer.prototype.$interpolate=null,Formalizer.types={columns:"columns"},Formalizer.templates=[],Formalizer.parsers={},Formalizer.loadTemplates=function(a,b,d){return a.all(this.templates.concat(["error-list","input","textarea","checkbox","select","submit","typeahead","checkbox-list","columns"]).map(function(a){return b.get("templates/formalizer-"+a+".tpl.html",{cache:d}).success(function(b){c[a]=b})}))},Formalizer.prototype.getTemplate=function(a){var b=c[Formalizer.types[a]]||null;if(!b)throw new Error("template not found for: "+a);return b},Formalizer.prototype.submit=function(){var a=this.$parse(this.onSubmit)(this.$scope.$parent),b=this.$scope[this.name];if(!a)throw new Error("options.onSubmit is required");if(++this.attempts,b.$valid){var c,d,e,f,g={},h=null;for(c in b)if("$"!==c[0])if(f=this.fields.filter(function(a){return a.formalizer.element.attrs.name===c}),b[c].$dirty)g[c]=b[c].$modelValue;else if(f&&f.length&&"file"===f[0].type)for(e=f[0].domElement[0],h=h||[],d=0;d<e.files.length;++d)h.push(e.files[d]);return a(g,h,this.$scope.$eval(this.model),b)}this.$log.info("$invalid = true, no submit")},Formalizer.prototype.callParser=function(a,b,c){var d,e=b.type;return"function"==typeof Formalizer.parsers[e]&&"post"===a?d=Formalizer.parsers[e](this.$scope,b,this):Formalizer.parsers[e]&&"function"==typeof Formalizer.parsers[e][a]&&(d=Formalizer.parsers[e][a](this.$scope,b,this,c)),d},Formalizer.prototype.createFieldMeta=function(b,c,d,e){var f;b.constraints=b.constraints||{};var g={type:b.type||"text",scope_name:c,container:{"class":["form-group"]},label:{"class":["control-label"].concat((b.labelClass||"").split(" "))},element:{container:{"class":[]},wrap:{"class":[]},attrs:{name:b.name,id:this.name+"-"+b.name,type:b.type||"text","ng-formalizer-attach":d},right:"",left:""},messages:b.messages||{},source:null,source_display:b.source_display||null,source_model:b.source_model||null,options:angular.extend(b.options||{},{scope_name:c})};b.default&&(g.element.attrs["ng-default"]="$field.default");var h=g.element.attrs.name;"string"==typeof b.source?(g.source=e.$eval(b.source),e.$watch(b.source,function(a){g.source=a})):void 0!==b.source&&(g.source=b.source,e.$watch("$field.source",function(a){g.source=a})),g.element.attrs["ng-model"]=b.model||this.model+"."+h,g.element.attrs["class"]=["form-control"].concat((b["class"]||"").split(" ")),g.element.attrs["ng-class"]="{'has-error': $formalizer.attempts > 0 && "+this.name+"."+g.element.attrs.name+".$invalid}",g.element.attrs["ng-placeholder"]=b.placeholder||"";for(f in b.constraints)"min"===f||"max"===f?g.element.attrs[f]=b.constraints[f]:g.element.attrs["ng-"+f]=b.constraints[f];switch(this.type){case"horizontal":"checkbox"===b.type?(g.element.container["class"].push("col-sm-offset-2"),g.label["class"].push("col-sm-12"),a(g.label["class"],"control-label")):(g.element.container["class"].push("col-sm-9"),g.label["class"].push("col-sm-2"));break;case"vertical":break;case"inline":}return g},Formalizer.prototype.createField=function(a,d,e){d.$field=a;var f,g,h,i;if(!a.name&&"raw"!==a.type)throw this.$log.log(a),new Error("invalid field without name");var j="$field.formalizer";this.callParser("pre",a),i=this.createFieldMeta(a,j,e,d),this.callParser("post",i),Object.defineProperty(a,"formalizer",{value:i,writable:!0,enumerable:!1,configurable:!1}),b(i.element.wrap),b(i.container),b(i.element.container),b(i.element.attrs),b(i.label),g=[];for(f in i.element.attrs)g.push(f+'="'+i.element.attrs[f]+'"');g=g.join(" "),h=this.getTemplate(i.type);var k="";-1!==h.indexOf("%element-error-list%")&&(k=this.$interpolate(this.$interpolate(c["error-list"])(i))(i));var l=h.replace("%element-attributes%",g).replace("%element-error-list%",k).replace(/%scope-form-name%/g,this.name);l=this.$interpolate(l)(i).replace(/\\\{/g,"{").replace(/\\\}/g,"}");var m=this.callParser("html",a,l);return m&&(l=m),l},Formalizer.prototype.createColumns=function(a,b){var c;for(c=0;c<a.length;++c)if(!a[c].cols)throw this.$log.error(a[c]),new Error("cols is not defined");return b.columns=a,this.getTemplate("columns")},Formalizer.prototype.setModel=function(a,b,c){var d=this.$scope.$eval(this.model);(!d[a]||c)&&(d[a]=b),Array.isArray(d[a])&&c&&-1===d[a].indexOf(b)&&d[a].push(b)},Formalizer.toFormData=function(a,b,c){var d,e=new FormData,f=0;for(e.append(data_name,JSON.stringify(a)),d=0;d<c.length;d++)e.append("file"+ ++f,c[d]);return e}}(),function(){"use strict";Formalizer.templates.push("raw"),Formalizer.types.raw="raw",Formalizer.parsers.raw={pre:function(a,b,c){b.template=c.$sce.trustAsHtml(b.template)},html:function(a,b,c,d){return d.replace("%content%",b.template)}}}(),function(){"use strict";function a(a,b){var c=a.indexOf(b);return-1!==c?a.splice(c,1):!1}Formalizer.templates.push("submit"),Formalizer.types.submit="submit",Formalizer.parsers.submit=function(b,c){delete c.element.attrs["ng-model"],delete c.element.attrs["ng-class"],delete c.element.attrs["ng-placeholder"],a(c.element.attrs["class"],"form-control"),c.element.attrs["class"].push("btn")}}(),function(){"use strict";Formalizer.templates.push("select"),Formalizer.types.select="select",Formalizer.parsers.select=function(a,b,c){b.defaultOption=c.empty_msg?'<option value="">'+c.empty_msg+"</option>":"",b.source_display=b.source_display||"label";var d=b.source_model?"."+b.source_model:"";b.element.attrs["ng-options"]="c"+d+" as c."+b.source_display+" for c in $field.formalizer.source",b.options.multiple&&(b.element.attrs.multiple="multiple")}}(),function(){"use strict";Formalizer.templates.push("textarea"),Formalizer.types.textarea="textarea",Formalizer.parsers.textarea=function(){}}(),function(){"use strict";Formalizer.templates.push("checkbox"),Formalizer.types.checkbox="checkbox",Formalizer.parsers.checkbox=function(a,b){b.container["class"].push("checkbox")}}(),function(){"use strict";function a(a,b){var c=a.indexOf(b);return-1!==c?a.splice(c,1):!1}Formalizer.templates.push("radio-list"),Formalizer.types["radio-list"]="radio-list",Formalizer.parsers["radio-list"]=function(b,c){c.element.attrs.type="radio",c.container["class"].push("radio"),a(c.element.attrs["class"],"form-control"),c.source_model=c.source_model?"."+c.source_model:""}}(),function(){"use strict";function a(a){return a.replace(d,function(a,b,c,d){return d?c.toUpperCase():c}).replace(e,"Moz$1")}function b(a,b){var c=a.indexOf(b);return-1!==c?a.splice(c,1):!1}var c=["typeahead-append-to-body","typeahead-editable","typeahead-input-formatter","typeahead-loading","typeahead-min-length","typeahead-template-url","typeahead-wait-ms"],d=/([\:\-\_]+(.))/g,e=/^moz([A-Z])/;Formalizer.templates.push("typeahead"),Formalizer.types.typeahead="typeahead",Formalizer.types["typeahead-multi"]="typeahead",Formalizer.parsers.typeahead=function(a,b){b.element.attrs.type="text",b.element.attrs.typeahead=b.source_display?"p as p."+b.source_display+" for p in $field.formalizer.source | filter:{"+b.source_display+":$viewValue}":"for p in $field.formalizer.source",angular.forEach(c,function(a){b.options[a]&&(b.element.attrs[a]=b.options[a])})},Formalizer.parsers["typeahead-multi"]=function(c,d){var e=d.element.attrs.name,f=a("add-"+e),g=a("del-"+e),h=d.element.attrs["ng-model"],i=d.element.attrs["ng-model"]+"_sel";d.element.attrs["ng-model"]=i;var j=c.$eval(h);void 0===j&&c.$eval(h+" = []"),c[f]=function(a){var b=c.$eval(h);-1===b.indexOf(a)&&b.push(a),c.$eval(i+" = ''")},c[g]=function(a){var d=c.$eval(h);b(d,a)},d.options.model=h,d.options.del_fn=g,d.element.attrs["typeahead-on-select"]=f+"($item, $model, $label)",Formalizer.parsers.typeahead(c,d)}}(),function(){"use strict";var a=["datepicker-mode","min-date","max-date","date-disabled","show-weeks","starting-day","init-date","min-mode","max-mode","format-day","format-month","format-year","format-day-header","format-day-title","format-month-title","year-range","show-button-bar","current-text","clear-text","close-text","close-on-date-selection","datepicker-append-to-body","datepicker-options"];Formalizer.types.datepicker="input",Formalizer.parsers.datepicker=function(b,c){var d=c.element.attrs.name,e=d+"Open",f=d+"Close",g=c.options["datepicker-options"]||d+"Options";angular.forEach(a,function(a){c.options[a]&&(c.element.attrs[a]=c.options[a])}),c.element.wrap["class"].push("input-group"),c.element.right='<span class="input-group-btn"><button ng-click="'+e+'($event)" class="btn btn-default" type="button"><i class="glyphicon glyphicon-calendar"></i></button>',c.element.attrs["is-open"]=g,c.element.attrs["datepicker-popup"]=c.options["datepicker-popup"]||"",c.element.attrs["ng-focus"]=e+"()",c.element.attrs["ng-datepicker-fix"]="",b[g]=!1,b[f]=function(){b[g]=!1},b[e]=function(a){a&&(a.preventDefault(),a.stopPropagation()),b[g]=!0,a&&setTimeout(function(){angular.element("#"+c.element.attrs.id).focus()},0)}}}(),function(){"use strict";Formalizer.templates.push("input"),Formalizer.types.text="input",Formalizer.types.password="input",Formalizer.types.number="input",Formalizer.types.email="input",Formalizer.types.tel="input",Formalizer.types.url="input",Formalizer.types.file="input"}(),function(){"use strict";function a(a,b){var c=a.indexOf(b);return-1!==c?a.splice(c,1):!1}Formalizer.templates.push("checkbox-list"),Formalizer.types["checkbox-list"]="checkbox-list",Formalizer.parsers["checkbox-list"]=function(b,c){var d=c.element.attrs["checklist-model"]=c.element.attrs["ng-model"];delete c.element.attrs["ng-model"],c.options.chkall_model=c.scope_name+".options.chkall_value",c.source_display=c.source_display||"label",c.options.check_all=function(){var a=b.$eval(c.options.chkall_model),e=b.$eval(d);if(void 0===e&&(b.$eval(d+" = []"),e=b.$eval(d)),e.splice(0,e.length),a){var f=b.$eval("$field.formalizer.source");f.forEach(function(a,d){e.push(b.$eval("$field.formalizer.source["+d+"]"+(c.source_model?"."+c.source_model:"")))})}},c.element.attrs["checklist-value"]="checkbox_data"+(c.source_model?"."+c.source_model:""),c.element.attrs.type="checkbox",c.container["class"].push("checkbox"),a(c.element.attrs["class"],"form-control")}}(),function(){"use strict";function a(a,b){var c=a.indexOf(b);return-1!==c?a.splice(c,1):!1}Formalizer.templates.push("slider"),Formalizer.types.slider="slider",Formalizer.parsers.slider=function(b,c){a(c.element.attrs["class"],"form-control"),["min","max","step","precision","orientation","range","selection","tooltip","tooltipSeparator","tooltipSplit","handle","reversed","enabled","naturalArrowKeys","sliderId","updateEvent"].forEach(function(a){void 0!==c.options[a]&&(c.element.attrs[a]=c.options[a])})}}(),function(){angular.module("formalizer",["ui.bootstrap","checklist-model","ui.bootstrap-slider","formalizer-tpls"]).value("FormalizerConfig",{}).directive("ngFormalizer",["$parse","$interpolate","$http","$templateCache","$q","$log","FormalizerConfig",function(a,b,c,d,e,f,g){var h=Formalizer.loadTemplates(e,c,d,g),i=angular.version;return{restrict:"A",replace:!0,scope:!0,templateUrl:"templates/formalizer-form-"+i.major+"."+Math.min(3,i.minor)+".tpl.html",priority:500,controller:function(c){var d=new Formalizer(c,a,b,f);if(angular.version.minor>2){var e=this;Object.keys(Formalizer.prototype).forEach(function(a){e[a]=d[a]})}return c.$formalizer=d,c.$formalizer},compile:function(){return{pre:function(a,b,c){var d=(jQuery(b).find(".fieldset-contents"),a.$eval(c.ngFormalizer)),e=a.$formalizer;if(!d)throw new Error("formalizer configuration must be sent");if(!d.name)throw new Error("formalizer require form name");h.then(function(){f.info("formalizer is ready");a.$watch(c.ngFormalizer,function(a){["name","type","model","legend","onSubmit"].forEach(function(b){e[b]=a[b]}),e.horizontal=e.vertical=e.inline=!1,e[e.type]=!0},!0)}),["name","type","legend","onSubmit"].forEach(function(a){e[a]=d[a]}),e.horizontal=e.vertical=e.inline=!1,e[e.type]=!0,"string"==typeof d.fields?a.$watch(d.fields,function(a){e.fields=a},!0):e.fields=d.fields},post:function(){}}}}}])}(),angular.module("formalizer").directive("ngFormalizerField",["$timeout","$compile",function(a,b){return{scope:!0,link:function(c,d,e){var f,g=c.$formalizer,h=c.$eval(e.ngFormalizerField);f=Array.isArray(h)?g.createColumns(h,c):g.createField(h,c,c.$index);var i=angular.element(f);d.append(i),a(function(){b(i.contents())(c),c.$digest()})}}}]),angular.module("formalizer").directive("ngFormalizerAttach",function(){return{link:function(a,b){a.$eval("$field").formalizer.domElement=b}}}),angular.module("formalizer").directive("ngBlacklist",function(){return{require:"ngModel",link:function(a,b,c,d){var e=a.$eval(c.ngBlacklist);"string"==typeof e&&(e=e.split(",")),d.$parsers.unshift(function(a){return d.$setValidity("blacklist",-1===e.indexOf(a)),a})}}}),angular.module("formalizer").directive("ngEqualTo",function(){return{require:"?ngModel",link:function(a,b,c,d){d&&a.$watch(c.ngEqualTo,function(a){var b=""===d.$modelValue?null:d.$modelValue||null,c=""===a?null:a||null;d.$setValidity("equal-to",c==b)})}}}),function(){"use strict";function a(a){return a.replace(b,function(a,b,c,d){return d?c.toUpperCase():c}).replace(c,"Moz$1")}var b=/([\:\-\_]+(.))/g,c=/^moz([A-Z])/;angular.forEach({"only-alpha":/^[a-zA-Z]*$/i,"one-upper":/^(?=.*[A-Z]).+$/,"one-lower":/^(?=.*[a-z]).+$/,"one-number":/^(?=.*[0-9]).+$/,"one-alpha":/^(?=.*[a-z]).+$/i,"no-spaces":/^[^\s]+$/,hexadecimal:/^[0-9a-fA-F]+$/,"hex-color":/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/},function(b,c){angular.module("formalizer").directive(a("ng-"+c),function(){return{require:"ngModel",link:function(a,d,e,f){f.$parsers.unshift(function(a){return f.$setValidity(c,b.test(a)),a})}}})})}(),angular.module("formalizer").constant("datepickerPopupFix",{datepickerPopup:"YYYY-MM-DD",datepickerTZ:void 0}).directive("ngDatepickerFix",["datepickerPopupFix",function(a){return{require:"?ngModel",priority:100,link:function(b,c,d,e){e.$parsers.unshift(function(b){var c;return c="string"==typeof b?moment(b,a.datepickerPopup):moment(b),c.isValid()?void 0!==a.datepickerTZ?new Date(c.toDate().toDateString()+" 00:00 GMT"+a.datepickerTZ):c.toDate():b})}}}]),angular.module("formalizer").directive("ngPopulate",function(){return{require:["^ngFormalizer","ngModel"],link:function(a,b,c,d){$ngFormalizer=d[0],$ngModel=d[1];var e=a.$eval(c.ngPopulate);$ngModel.$parsers.push(function(a){return e&&e[a]&&$ngFormalizer.setModel(e[a][0],e[a][1],e[a][2]||!1),a})}}}),angular.module("formalizer").directive("ngServerValidation",["$http",function(a){return{require:"ngModel",link:function(b,c,d,e){var f,g,h=d.ngServerValidation,i=d.ngRequestKey||"value",j=d.ngResponseKey||"value";jQuery(c).focusout(function(){if(g!=f){g=f;var b={};b[i]=f,a.post(h,b).success(function(a){e.$setValidity("server-validation-in-progress",!0),e.$setValidity("server-validation",!!a[j])}).error(function(){e.$setValidity("server-validation-in-progress",!0)})}}),e.$parsers.unshift(function(a){return a?(e.$setValidity("server-validation-in-progress",!1),f=a,a):void 0})}}}]),angular.module("formalizer").directive("ngDefault",["$timeout",function(a){return{require:"ngModel",link:function(b,c,d,e){function f(a){return"number"==typeof a&&""+a=="NaN"}var g=b.$eval(d.ngDefault);console.log(g),console.log(e),a(function(){console.log("$timeout",e),console.log(f(e.$modelValue),void 0===e.$modelValue),(f(e.$modelValue)||void 0===e.$modelValue)&&b.$eval(d.ngModel+" = "+JSON.stringify(g))}),e.$parsers.unshift(function(a){return console.log("???!!"),void 0===a?g:a})}}}]);